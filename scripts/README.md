# oppcastr Scripts

This directory contains standalone scripts for building the `oppcastr` database and processing model inference results.

## Data Ingestion & Pipeline

When you train a new model or generate new scores, use these scripts to update the dashboard:

1. **`upload_historical_scores.py`**
   - **Purpose:** Uploads the 2021-2024 parcel-level protest probabilities into Supabase.
   - **Details:** Automatically zero-pads TCAD parcel IDs to 10 characters so they join properly with the `geo_parcel_poly` table, and uploads data in batches of 5000 using the Supabase REST API (via `oppcastr_bulk_insert_scores`). 
   - **Usage:** Run `python scripts/upload_historical_scores.py` from the project root (`v0-properlytic-8v/`).

2. **Aggregation (SQL Editor)**
   - **Purpose:** Cascades the updated parcel scores up to the Tabblock, Tract, and ZCTA levels.
   - **Usage:** Copy the contents of `sql/schema/oppcastr_aggregate.sql` and run them **one at a time** in the Supabase SQL Editor.

## Legacy & Other Scripts
- `compute_tract_protest.py` / `build_protest_results.py`: Used for initial diagnostics and static JSON building before the full Supabase schema was deployed. 
- `tract_protest_upsert.sql`: Generated by the python scripts prior to the dynamic MVT tile pipeline.
- `ch.ts`, `check-parcels.ts`, etc.: Temporary diagnostic scripts have been purged to keep this directory clean.
